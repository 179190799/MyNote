# Android 性能优化
## Android 的性能优化方法 
1. 布局优化
    布局优化的思想就是尽量减少布局文件的层级。
    如何进行布局优化：
    首先删除布局中无用的控件和层级；其次有选择地使用性能较低的 ViewGroup。
    布局优化的另一种手段是采用<include\>标签、<merge\>标签和 ViewStub

    <include\>标签：
    >主要用于布局重用。
    可以将一个指定的布局文件加载到当前布局文件中，
    <include\>标签只支持以 android:layout_开头的属性，其他属性是不支持的。android:id 这个属性例外。
    
    <merge\>标签：
    ><merge\>标签一般和<include\>标签一起使用从而减少布局的层级，

    ViewStub：
    >ViewStub 继承了 View，非常轻量且宽/高都是0。ViewStub 的意义在于按需即在所需的布局文件。

2. 绘制优化
    绘制优化是指 View 的 onDraw 方法要避免执行大量的操作，主要体现在：
    - 首先，onDraw 中不要创建新的局部对象，因为 onDraw 方法可能会被频繁调用，会在一瞬间产生大量的临时对象，不仅占用过多内存还导致系统更加频繁 gc，降低程序的执行效率。
    - 另一方面，onDraw 方法中不要做耗时的任务，也不能执行成千上万次的循环操作。官方的标准中 View 的绘制帧率保证60fps 是最佳的，这就要求每帧的绘制时间不超过16ms（16ms = 1000/60）。

3. 内存泄漏优化
    泄漏发生的场景：

    - 静态变量导致的内存泄漏
    - 单例模式导致的内存泄漏
    - 属性动画导致的内存泄漏
    
4. 响应速度优化和 ANR 日志分析
    Android 规定，Activity 如果5秒钟之内无法响应屏幕触摸事件或者键盘输入事件就会出现 ANR，BroadcastReceiver 如果10秒钟之内还未执行玩操作会出现 ANR。
    当一个进程发生 ANR 之后，系统会在/data/anr 目录下创建一个文件 traces.txt，通过分析这个文件可以定位出 ANR 的原因。

5. ListView 和 Bitmap 优化
    ListView：
        首先要采用 ViewHolder 并避免在 getView 执行耗时操作；
        其次要根据列表的滑动状态来控制任务的执行频率；
        最后可以尝试开启硬件的加速来使 ListView 的滑动更加流畅。

6. 线程优化
    线程优化的思想是采用线程池，避免程序中存在大量的 Thread。

7. 一些性能建议
    - 避免创建过多的对象；
    - 不要过多使用枚举，枚举占用的内存空间比整型大；
    - 常量请使用 static final 来修饰；
    - 使用一些 Android 特有的数据结构；
    - 适当使用软引用和弱引用；
    - 采用内存缓存和磁盘缓存；
    - 尽量采用静态内部类，可以避免潜在的由于内部类而导致的内存泄漏。

## 提高程序的可维护性
- 命名要规范，要正确地传达出变量或者方法的含义，少用缩写。
- 代码的排版上需要留出合理的空白区分不同的代码块，其中同类变量的声明要放在一组，两类变量之间要留出一行空白作为区分。
- 仅为非常关键的代码添加注释，其他地方不写注释。




                                                                    2017.8.30
                                                                       W.Z.H
 
